<!DOCTYPE html><html lang="cn" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>大数据技术之HBase、Phoenix | XiWei</title><meta name="author" content="XiWei"><meta name="copyright" content="XiWei"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="大数据技术之HBase、Phoenix第1章 HBase简介1.1 HBase定义Apache HBase™ 是以 HDFS 为数据存储的，一种分布式、可扩展的 NoSQL 数据库。 1.2 HBase数据模型HBase 的设计理念依据 Google 的 BigTable 论文，论文中对于数据模型的首句介绍如下：  HBase 使用与 Bigtable 非常相似的数据模型。用户将数据行存储在带标签">
<meta property="og:type" content="article">
<meta property="og:title" content="大数据技术之HBase、Phoenix">
<meta property="og:url" content="https://xi-weix.github.io/2025/01/14/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8BHBase%E3%80%81Phoenix/index.html">
<meta property="og:site_name" content="XiWei">
<meta property="og:description" content="大数据技术之HBase、Phoenix第1章 HBase简介1.1 HBase定义Apache HBase™ 是以 HDFS 为数据存储的，一种分布式、可扩展的 NoSQL 数据库。 1.2 HBase数据模型HBase 的设计理念依据 Google 的 BigTable 论文，论文中对于数据模型的首句介绍如下：  HBase 使用与 Bigtable 非常相似的数据模型。用户将数据行存储在带标签">
<meta property="og:locale">
<meta property="og:image" content="https://xi-weix.github.io/img/%E9%9B%AA%E8%8A%B1.png">
<meta property="article:published_time" content="2025-01-14T13:20:00.000Z">
<meta property="article:modified_time" content="2025-01-15T02:03:57.128Z">
<meta property="article:author" content="XiWei">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://xi-weix.github.io/img/%E9%9B%AA%E8%8A%B1.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "大数据技术之HBase、Phoenix",
  "url": "https://xi-weix.github.io/2025/01/14/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8BHBase%E3%80%81Phoenix/",
  "image": "https://xi-weix.github.io/img/%E9%9B%AA%E8%8A%B1.png",
  "datePublished": "2025-01-14T13:20:00.000Z",
  "dateModified": "2025-01-15T02:03:57.128Z",
  "author": [
    {
      "@type": "Person",
      "name": "XiWei",
      "url": "https://xi-weix.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://xi-weix.github.io/2025/01/14/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8BHBase%E3%80%81Phoenix/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '大数据技术之HBase、Phoenix',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/beach.jpeg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/%E9%9B%AA%E8%8A%B1.png" alt="Logo"><span class="site-name">XiWei</span></a><a class="nav-page-title" href="/"><span class="site-name">大数据技术之HBase、Phoenix</span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">大数据技术之HBase、Phoenix</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-01-14T13:20:00.000Z" title="Created 2025-01-14 21:20:00">2025-01-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-01-15T02:03:57.128Z" title="Updated 2025-01-15 10:03:57">2025-01-15</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="大数据技术之HBase、Phoenix"><a href="#大数据技术之HBase、Phoenix" class="headerlink" title="大数据技术之HBase、Phoenix"></a>大数据技术之HBase、Phoenix</h1><h2 id="第1章-HBase简介"><a href="#第1章-HBase简介" class="headerlink" title="第1章 HBase简介"></a>第1章 HBase简介</h2><h3 id="1-1-HBase定义"><a href="#1-1-HBase定义" class="headerlink" title="1.1 HBase定义"></a>1.1 HBase定义</h3><p>Apache HBase™ 是以 HDFS 为数据存储的，一种分布式、可扩展的 NoSQL 数据库。</p>
<h3 id="1-2-HBase数据模型"><a href="#1-2-HBase数据模型" class="headerlink" title="1.2 HBase数据模型"></a>1.2 HBase数据模型</h3><p>HBase 的设计理念依据 Google 的 BigTable 论文，论文中对于数据模型的首句介绍如下：</p>
<blockquote>
<p>HBase 使用与 Bigtable 非常相似的数据模型。用户将数据行存储在带标签的表中。数据行具有可排序的键和任意数量的列。该表存储稀疏，因此如果用户喜欢，同一表中的行可以具有疯狂变化的列。</p>
</blockquote>
<p>最终理解 HBase 数据模型的关键在于<strong>稀疏、分布式、多维、排序的映射</strong>。其中映射 map 指代非关系型数据库的 key-Value 结构。</p>
<h4 id="1-2-1-HBase逻辑结构"><a href="#1-2-1-HBase逻辑结构" class="headerlink" title="1.2.1 HBase逻辑结构"></a>1.2.1 HBase逻辑结构</h4><p>HBase 可以用于存储多种结构的数据，以 JSON 为例，存储的数据原貌为：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;row_key1&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;info1&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zhangsan&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">20</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;info2&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;beijing&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;row_key2&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="1-2-2-HBase物理存储结构"><a href="#1-2-2-HBase物理存储结构" class="headerlink" title="1.2.2 HBase物理存储结构"></a>1.2.2 HBase物理存储结构</h4><p>物理存储结构即为数据映射关系，而在概念视图的空单元格，底层实际根本不存储。</p>
<h4 id="1-2-3-数据模型"><a href="#1-2-3-数据模型" class="headerlink" title="1.2.3 数据模型"></a>1.2.3 数据模型</h4><ol>
<li><p><strong>Name Space</strong><br>命名空间，类似于关系型数据库的 database 概念，每个命名空间下有多个表。HBase 两个自带的命名空间，分别是 <code>hbase</code> 和 <code>default</code>，<code>hbase</code> 中存放的是 HBase 内置的表，<code>default</code> 表是用户默认使用的命名空间。</p>
</li>
<li><p><strong>Table</strong><br>类似于关系型数据库的表概念。不同的是，HBase 定义表时只需要声明列族即可，不需要声明具体的列。因为数据存储时稀疏的，所有往 HBase 写入数据时，字段可以动态、按需指定。因此，和关系型数据库相比，HBase 能够轻松应对字段变更的场景。</p>
</li>
<li><p><strong>Row</strong><br>HBase 表中的每行数据都由一个 RowKey 和多个 Column（列）组成，数据是按照 RowKey 的字典顺序存储的，并且查询数据时只能根据 RowKey 进行检索，所以 RowKey 的设计十分重要。</p>
</li>
<li><p><strong>Column</strong><br>HBase 中的每个列都由 Column Family（列族）和 Column Qualifier（列限定符）进行限定，例如 <code>info:name</code>，<code>info:age</code>。建表时，只需指明列族，而列限定符无需预先定义。</p>
</li>
<li><p><strong>Time Stamp</strong><br>用于标识数据的不同版本（version），每条数据写入时，系统会自动为其加上该字段，其值为写入 HBase 的时间。</p>
</li>
<li><p><strong>Cell</strong><br>由 <code>&#123;rowkey, column Family:column Qualifier, timestamp&#125;</code> 唯一确定的单元。cell 中的数据全部是字节码形式存储。</p>
</li>
</ol>
<h3 id="1-3-HBase基本架构"><a href="#1-3-HBase基本架构" class="headerlink" title="1.3 HBase基本架构"></a>1.3 HBase基本架构</h3><p>HBase 的架构角色包括：</p>
<ol>
<li><p><strong>Master</strong><br>实现类为 HMaster，负责监控集群中所有的 RegionServer 实例。主要作用如下：</p>
<ul>
<li>管理元数据表格 <code>hbase:meta</code>，接收用户对表格创建修改删除的命令并执行。</li>
<li>监控 region 是否需要进行负载均衡，故障转移和 region 的拆分。</li>
</ul>
</li>
<li><p><strong>Region Server</strong><br>实现类为 HRegionServer，主要作用如下：</p>
<ul>
<li>负责数据 cell 的处理，例如写入数据 put，查询数据 get 等。</li>
<li>拆分合并 region 的实际执行者，由 master 监控，由 regionServer 执行。</li>
</ul>
</li>
<li><p><strong>Zookeeper</strong><br>HBase 通过 Zookeeper 来做 master 的高可用、记录 RegionServer 的部署信息、并且存储有 meta 表的位置信息。</p>
</li>
<li><p><strong>HDFS</strong><br>HDFS 为 HBase 提供最终的底层数据存储服务，同时为 HBase 提供高容错的支持。</p>
</li>
</ol>
<h2 id="第2章-HBase快速入门"><a href="#第2章-HBase快速入门" class="headerlink" title="第2章 HBase快速入门"></a>第2章 HBase快速入门</h2><h3 id="2-1-HBase安装部署"><a href="#2-1-HBase安装部署" class="headerlink" title="2.1 HBase安装部署"></a>2.1 HBase安装部署</h3><h4 id="2-1-1-Zookeeper正常部署"><a href="#2-1-1-Zookeeper正常部署" class="headerlink" title="2.1.1 Zookeeper正常部署"></a>2.1.1 Zookeeper正常部署</h4><p>首先保证 Zookeeper 集群的正常部署，并启动之。</p>
<h4 id="2-1-2-Hadoop正常部署"><a href="#2-1-2-Hadoop正常部署" class="headerlink" title="2.1.2 Hadoop正常部署"></a>2.1.2 Hadoop正常部署</h4><p>Hadoop 集群的正常部署并启动。</p>
<h4 id="2-1-3-HBase的解压"><a href="#2-1-3-HBase的解压" class="headerlink" title="2.1.3 HBase的解压"></a>2.1.3 HBase的解压</h4><ol>
<li><p>解压 HBase 到指定目录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf hbase-2.5.10-bin.tar.gz -C /opt/module/</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置环境变量：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> HBASE_HOME=/opt/module/hbase</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HBASE_HOME</span>/bin</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 <code>source</code> 让配置的环境变量生效：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="2-1-4-HBase的配置文件"><a href="#2-1-4-HBase的配置文件" class="headerlink" title="2.1.4 HBase的配置文件"></a>2.1.4 HBase的配置文件</h4><ol>
<li><p><strong>hbase-env.sh</strong> 修改内容，可以添加到最后：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> JAVA_HOME=/opt/module/jdk1.8.0_212</span><br><span class="line"><span class="built_in">export</span> HBASE_MANAGES_ZK=<span class="literal">false</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>hbase-site.xml</strong> 修改内容：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.rootdir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://hadoop102:8020/hbase<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.cluster.distributed<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop102,hadoop103,hadoop104<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>regionservers</strong> 文件内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hadoop102</span><br><span class="line">hadoop103</span><br><span class="line">hadoop104</span><br></pre></td></tr></table></figure>
</li>
<li><p>解决 HBase 和 Hadoop 的 log4j 兼容性问题，修改 HBase 的 jar 包，使用 Hadoop 的 jar 包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> /opt/module/hbase/lib/client-facing-thirdparty/slf4j-reload4j-1.7.33.jar /opt/module/hbase/lib/client-facing-thirdparty/slf4j-reload4j-1.7.33.jar.bak</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="2-1-5-HBase远程发送到其他集群"><a href="#2-1-5-HBase远程发送到其他集群" class="headerlink" title="2.1.5 HBase远程发送到其他集群"></a>2.1.5 HBase远程发送到其他集群</h4><p>将配置好的 HBase 分发到其他节点：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp -r /opt/module/hbase bigdata@hadoop103:/opt/module/</span><br><span class="line">scp -r /opt/module/hbase bigdata@hadoop104:/opt/module/</span><br></pre></td></tr></table></figure>

<h4 id="2-1-6-HBase服务的启动"><a href="#2-1-6-HBase服务的启动" class="headerlink" title="2.1.6 HBase服务的启动"></a>2.1.6 HBase服务的启动</h4><ol>
<li><p><strong>单点启动</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bin/hbase-daemon.sh start master</span><br><span class="line">bin/hbase-daemon.sh start regionserver</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>群启</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start-hbase.sh</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>对应的停止服务</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stop-hbase.sh</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="2-1-7-查看HBase页面"><a href="#2-1-7-查看HBase页面" class="headerlink" title="2.1.7 查看HBase页面"></a>2.1.7 查看HBase页面</h4><p>启动成功后，可以通过 <code>http://hadoop102:16010</code> 访问 HBase 管理页面。</p>
<h4 id="2-1-8-高可用（可选）"><a href="#2-1-8-高可用（可选）" class="headerlink" title="2.1.8 高可用（可选）"></a>2.1.8 高可用（可选）</h4><p>在 HBase 中 HMaster 负责监控 HRegionServer 的生命周期，均衡 RegionServer 的负载。如果 HMaster 挂掉了，整个 HBase 集群将陷入不健康的状态。因此，HBase 支持对 HMaster 的高可用配置。</p>
<ol>
<li><p>关闭 HBase 集群（如果没有开启则跳过此步）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stop-hbase.sh</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 <code>conf</code> 目录下创建 <code>backup-masters</code> 文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> hadoop103 &gt; conf/backup-masters</span><br></pre></td></tr></table></figure>
</li>
<li><p>将整个 <code>conf</code> 目录 <code>scp</code> 到其他节点：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp -r conf bigdata@hadoop103:/opt/module/hbase/</span><br><span class="line">scp -r conf bigdata@hadoop104:/opt/module/hbase/</span><br></pre></td></tr></table></figure>
</li>
<li><p>重启 HBase，打开页面测试查看：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start-hbase.sh</span><br></pre></td></tr></table></figure>

<p>访问 <code>http://hadoop102:16010</code> 查看高可用状态。</p>
</li>
</ol>
<h3 id="2-2-HBase-Shell操作"><a href="#2-2-HBase-Shell操作" class="headerlink" title="2.2 HBase Shell操作"></a>2.2 HBase Shell操作</h3><h4 id="2-2-1-基本操作"><a href="#2-2-1-基本操作" class="headerlink" title="2.2.1 基本操作"></a>2.2.1 基本操作</h4><ol>
<li><p>进入 HBase 客户端命令行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hbase shell</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看帮助命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">help</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="2-2-2-namespace"><a href="#2-2-2-namespace" class="headerlink" title="2.2.2 namespace"></a>2.2.2 namespace</h4><ol>
<li><p>创建命名空间：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create_namespace <span class="string">&#x27;bigdata&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>查看所有的命名空间：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list_namespace</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="2-2-3-DDL"><a href="#2-2-3-DDL" class="headerlink" title="2.2.3 DDL"></a>2.2.3 DDL</h4><ol>
<li><p>创建表：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create <span class="string">&#x27;bigdata:student&#x27;</span>, &#123;NAME =&gt; <span class="string">&#x27;info&#x27;</span>, VERSIONS =&gt; 5&#125;, &#123;NAME =&gt; <span class="string">&#x27;msg&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看表：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">list</span><br><span class="line">describe <span class="string">&#x27;bigdata:student&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>修改表：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter <span class="string">&#x27;student1&#x27;</span>, &#123;NAME =&gt; <span class="string">&#x27;f1&#x27;</span>, VERSIONS =&gt; 3&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除表：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">disable</span> <span class="string">&#x27;student1&#x27;</span></span><br><span class="line">drop <span class="string">&#x27;student1&#x27;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="2-2-4-DML"><a href="#2-2-4-DML" class="headerlink" title="2.2.4 DML"></a>2.2.4 DML</h4><ol>
<li><p>写入数据：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">put <span class="string">&#x27;bigdata:student&#x27;</span>, <span class="string">&#x27;1001&#x27;</span>, <span class="string">&#x27;info:name&#x27;</span>, <span class="string">&#x27;zhangsan&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>读取数据：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">get <span class="string">&#x27;bigdata:student&#x27;</span>, <span class="string">&#x27;1001&#x27;</span></span><br><span class="line">scan <span class="string">&#x27;bigdata:student&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>删除数据：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">delete <span class="string">&#x27;bigdata:student&#x27;</span>, <span class="string">&#x27;1001&#x27;</span>, <span class="string">&#x27;info:name&#x27;</span></span><br><span class="line">deleteall <span class="string">&#x27;bigdata:student&#x27;</span>, <span class="string">&#x27;1001&#x27;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="第6章-整合Phoenix"><a href="#第6章-整合Phoenix" class="headerlink" title="第6章 整合Phoenix"></a>第6章 整合Phoenix</h2><p>​	Hive(速度慢，多表查询)</p>
<p>​	Hbase(速度快，单表查询)</p>
<h3 id="6-1-Phoenix简介"><a href="#6-1-Phoenix简介" class="headerlink" title="6.1 Phoenix简介"></a>6.1 Phoenix简介</h3><h4 id="6-1-1-Phoenix定义"><a href="#6-1-1-Phoenix定义" class="headerlink" title="6.1.1 Phoenix定义"></a>6.1.1 Phoenix定义</h4><p>Phoenix 是 HBase 的开源 SQL 皮肤。可以使用标准 JDBC API 代替 HBase 客户端 API 来创建表，插入数据和查询 HBase 数据。</p>
<h4 id="6-1-2-为什么使用Phoenix"><a href="#6-1-2-为什么使用Phoenix" class="headerlink" title="6.1.2 为什么使用Phoenix"></a>6.1.2 为什么使用Phoenix</h4><p>Phoenix 在 Client 和 HBase 之间放一个中间层不会减慢速度，因为用户编写的数据处理代码和 Phoenix 编写的没有区别。不仅如此，Phoenix 对于用户输入的 SQL 同样会有大量的优化手段。</p>
<h3 id="6-2-Phoenix快速入门"><a href="#6-2-Phoenix快速入门" class="headerlink" title="6.2 Phoenix快速入门"></a>6.2 Phoenix快速入门</h3><h4 id="6-2-1-安装"><a href="#6-2-1-安装" class="headerlink" title="6.2.1 安装"></a>6.2.1 安装</h4><ol>
<li>官网地址：<a target="_blank" rel="noopener" href="http://phoenix.apache.org/">http://phoenix.apache.org/</a></li>
<li><strong>Phoenix 部署</strong>：<ul>
<li><p>上传并解压 tar 包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf phoenix-hbase-2.5-5.2.1-bin.tar.gz -C /opt/module/</span><br><span class="line"><span class="built_in">mv</span> phoenix-hbase-2.5-5.2.1-bin/ phoenix</span><br></pre></td></tr></table></figure>
</li>
<li><p>复制 server 包并拷贝到各个节点的 hbase&#x2F;lib：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> phoenix-server-hbase-2.5-5.2.1.jar /opt/module/hbase/lib/</span><br><span class="line">xsync /opt/module/hbase/lib/phoenix-server-hbase-2.5-5.2.1.jar</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置环境变量：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PHOENIX_HOME=/opt/module/phoenix</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$PHOENIX_HOME</span>/bin</span><br></pre></td></tr></table></figure>
</li>
<li><p>二级索引配置：</p>
<p>添加如下配置到 HBase 的 <code>hbase-site.xml</code>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.regionserver.wal.codec<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.hbase.regionserver.wal.IndexedWALEditCodec<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>重启 HBase：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">stop-hbase.sh</span><br><span class="line">start-hbase.sh</span><br></pre></td></tr></table></figure>
</li>
<li><p>连接 Phoenix：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/module/phoenix/bin/sqlline.py hadoop102,hadoop103,hadoop104:2181</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h4 id="6-2-2-Phoenix-Shell操作"><a href="#6-2-2-Phoenix-Shell操作" class="headerlink" title="6.2.2 Phoenix Shell操作"></a>6.2.2 Phoenix Shell操作</h4><ol>
<li><p><strong>显示所有表</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!table 或 !tables</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>创建表</strong>：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE IF NOT EXISTS student (</span><br><span class="line">       <span class="built_in">id</span> VARCHAR primary key,</span><br><span class="line">       name VARCHAR,</span><br><span class="line">       age BIGINT,</span><br><span class="line">       addr VARCHAR</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>   在 phoenix 中，表名等会自动转换为大写，若要小写， 使用双引号，如”us_population”。</p>
<p>   指定多个列的联合作为 RowKey</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE IF NOT EXISTS student1 (</span><br><span class="line">      <span class="built_in">id</span> VARCHAR NOT NULL,</span><br><span class="line">      name VARCHAR NOT NULL,</span><br><span class="line">      age BIGINT,</span><br><span class="line">      addr VARCHAR</span><br><span class="line">CONSTRAINT my_pk PRIMARY KEY (<span class="built_in">id</span>, name));</span><br></pre></td></tr></table></figure></li>
</ol>
<p>注： Phoenix中建表，会在 HBase 中创建一张对应的表。为了减少数据对磁盘空间的占用， Phoenix默认会对 HBase中的列名做编码处理 。具体规则可参考官网链接：<br><a target="_blank" rel="noopener" href="https://phoenix.apache.org/columnencoding.html">https://phoenix.apache.org/columnencoding.html</a><br>若不想对列名编码，可在建表语句末尾加上 COLUMN_ENCODED_BYTES &#x3D; 0;</p>
<ol start="3">
<li><p><strong>插入数据</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPSERT INTO student VALUES(<span class="string">&#x27;1001&#x27;</span>, <span class="string">&#x27;zhangsan&#x27;</span>, 10, <span class="string">&#x27;beijing&#x27;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>查询记录</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM student;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>删除记录</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM student WHERE <span class="built_in">id</span>=<span class="string">&#x27;1001&#x27;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>删除表</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE student;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>退出命令行</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!quit</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="6-3-Phoenix二级索引"><a href="#6-3-Phoenix二级索引" class="headerlink" title="6.3 Phoenix二级索引"></a>6.3 Phoenix二级索引</h3><h4 id="6-3-1-二级索引配置文件"><a href="#6-3-1-二级索引配置文件" class="headerlink" title="6.3.1 二级索引配置文件"></a>6.3.1 二级索引配置文件</h4><p>添加如下配置到 HBase 的 <code>hbase-site.xml</code>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.regionserver.wal.codec<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.hbase.regionserver.wal.IndexedWALEditCodec<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="6-3-2-全局索引（global-index）"><a href="#6-3-2-全局索引（global-index）" class="headerlink" title="6.3.2 全局索引（global index）"></a>6.3.2 全局索引（global index）</h4><p>Global Index 是默认的索引格式，创建全局索引时，会在 HBase 中建立一张新表。也就 是说索引数据和数据表是存放在不同的表中的，<strong>因此全局索引适用于多读少写的业务场景</strong>。<br>写数据的时候会消耗大量开销， 因为索引表也要更新，而索引表是分布在不同的数据节 点上的，跨节点的数据传输带来了较大的性能消耗。</p>
<p>在读数据的时候 Phoenix 会选择索引表来降低查询消耗的时间。</p>
<ol>
<li><p>创建全局索引：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE INDEX my_index ON student1(age);</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除索引：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP INDEX my_index ON student1;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="创建全局索引"><a href="#创建全局索引" class="headerlink" title="创建全局索引"></a>创建全局索引</h2><p>在 Phoenix 中创建全局索引的语法如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX my_index <span class="keyword">ON</span> my_table (my_col);</span><br><span class="line"></span><br><span class="line"><span class="number">0</span>:   jdbc:phoenix:hadoop102,hadoop103,hadoop104<span class="operator">&gt;</span>: jdbc:phoenix:hadoop102,hadoop103,hadoop104<span class="operator">&gt;</span> <span class="keyword">CREATE</span> INDEX my_index <span class="keyword">ON</span> student1 (age);</span><br><span class="line"></span><br><span class="line"><span class="number">0</span>:   jdbc:phoenix:hadoop102,hadoop103,hadoop104<span class="operator">&gt;</span>: UPSERT <span class="keyword">INTO</span> student1 <span class="keyword">VALUES</span>(<span class="string">&#x27;1001&#x27;</span>, <span class="string">&#x27;zhangsan&#x27;</span>, <span class="number">10</span>, <span class="string">&#x27;beijing&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="查看索引是否有效"><a href="#查看索引是否有效" class="headerlink" title="查看索引是否有效"></a>查看索引是否有效</h2><p>可以使用 <code>explainPlan</code> 执行计划来查看索引是否有效。如果有索引，查询会变成范围扫描。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>: jdbc:phoenix:hadoop102,hadoop103,hadoop104<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> student1 <span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<p>执行计划输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+-------------------+----------------+----------------+----------------+</span><br><span class="line">| PLAN              | EST_BYTES_READ | EST_ROWS_READ  | EST_INF        |</span><br><span class="line">+-------------------+----------------+----------------+----------------+</span><br><span class="line">| CLIENT 1-CHUNK PARALLEL 1-WAY ROUND ROBIN RANGE SCAN OVER MY_INDEX [10] | null | null | null |</span><br><span class="line">| SERVER FILTER BY FIRST KEY ONLY | null | null | null |</span><br><span class="line">+-------------------+----------------+----------------+----------------+</span><br><span class="line">2 rows selected (0.044 seconds)</span><br></pre></td></tr></table></figure>

<h2 id="查询非索引字段"><a href="#查询非索引字段" class="headerlink" title="查询非索引字段"></a>查询非索引字段</h2><p>如果想查询的字段不是索引字段，索引表不会被使用，查询速度不会提升。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>: jdbc:phoenix:hadoop102,hadoop103,hadoop104<span class="operator">&gt;</span> EXPLAIN <span class="keyword">SELECT</span> id, name, addr <span class="keyword">FROM</span> student1 <span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<p>执行计划输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+-------------------+----------------+----------------+----------------+</span><br><span class="line">| PLAN              | EST_BYTES_READ | EST_ROWS_READ  | EST_INFO_TS    |</span><br><span class="line">+-------------------+----------------+----------------+----------------+</span><br><span class="line">| CLIENT 1-CHUNK PARALLEL 1-WAY ROUND ROBIN FULL SCAN OVER STUDENT1 | null | null | null |</span><br><span class="line">| SERVER FILTER BY AGE = 10 | null | null | null |</span><br><span class="line">+-------------------+----------------+----------------+----------------+</span><br><span class="line">2 rows selected (0.024 seconds)</span><br></pre></td></tr></table></figure>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>若想解决上述问题，可采用如下方案：</p>
<ol>
<li><strong>使用包含索引</strong>：创建包含其他字段的全局索引。</li>
<li><strong>使用本地索引</strong>：适用于写操作频繁的场景。</li>
</ol>
<h4 id="6-3-3-包含索引（covered-index）"><a href="#6-3-3-包含索引（covered-index）" class="headerlink" title="6.3.3 包含索引（covered index）"></a>6.3.3 包含索引（covered index）</h4><p>创建携带其他字段的全局索引：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE INDEX my_index ON student1 (age) INCLUDE (addr);</span><br></pre></td></tr></table></figure>

<h4 id="6-3-4-本地索引（local-index）"><a href="#6-3-4-本地索引（local-index）" class="headerlink" title="6.3.4 本地索引（local index）"></a>6.3.4 本地索引（local index）</h4><p>本地索引适用于写操作频繁的场景：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE LOCAL INDEX my_index ON student1 (age, addr);</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>注</strong>：以上为 HBase 和 Phoenix 的安装、配置及基本操作，更多高级功能请参考官方文档。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://xi-weix.github.io">XiWei</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://xi-weix.github.io/2025/01/14/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8BHBase%E3%80%81Phoenix/">https://xi-weix.github.io/2025/01/14/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8BHBase%E3%80%81Phoenix/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/%E9%9B%AA%E8%8A%B1.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/%E9%9B%AA%E8%8A%B1.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">XiWei</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">23</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Xi-WeiX"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8BHBase%E3%80%81Phoenix"><span class="toc-number">1.</span> <span class="toc-text">大数据技术之HBase、Phoenix</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC1%E7%AB%A0-HBase%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">第1章 HBase简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-HBase%E5%AE%9A%E4%B9%89"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1 HBase定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-HBase%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2 HBase数据模型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-1-HBase%E9%80%BB%E8%BE%91%E7%BB%93%E6%9E%84"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">1.2.1 HBase逻辑结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-HBase%E7%89%A9%E7%90%86%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">1.2.2 HBase物理存储结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-3-%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">1.2.3 数据模型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-HBase%E5%9F%BA%E6%9C%AC%E6%9E%B6%E6%9E%84"><span class="toc-number">1.1.3.</span> <span class="toc-text">1.3 HBase基本架构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC2%E7%AB%A0-HBase%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">1.2.</span> <span class="toc-text">第2章 HBase快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-HBase%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1 HBase安装部署</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-Zookeeper%E6%AD%A3%E5%B8%B8%E9%83%A8%E7%BD%B2"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">2.1.1 Zookeeper正常部署</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-Hadoop%E6%AD%A3%E5%B8%B8%E9%83%A8%E7%BD%B2"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">2.1.2 Hadoop正常部署</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-3-HBase%E7%9A%84%E8%A7%A3%E5%8E%8B"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">2.1.3 HBase的解压</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-4-HBase%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.1.4.</span> <span class="toc-text">2.1.4 HBase的配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-5-HBase%E8%BF%9C%E7%A8%8B%E5%8F%91%E9%80%81%E5%88%B0%E5%85%B6%E4%BB%96%E9%9B%86%E7%BE%A4"><span class="toc-number">1.2.1.5.</span> <span class="toc-text">2.1.5 HBase远程发送到其他集群</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-6-HBase%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%90%AF%E5%8A%A8"><span class="toc-number">1.2.1.6.</span> <span class="toc-text">2.1.6 HBase服务的启动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-7-%E6%9F%A5%E7%9C%8BHBase%E9%A1%B5%E9%9D%A2"><span class="toc-number">1.2.1.7.</span> <span class="toc-text">2.1.7 查看HBase页面</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-8-%E9%AB%98%E5%8F%AF%E7%94%A8%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89"><span class="toc-number">1.2.1.8.</span> <span class="toc-text">2.1.8 高可用（可选）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-HBase-Shell%E6%93%8D%E4%BD%9C"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2 HBase Shell操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">2.2.1 基本操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-namespace"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">2.2.2 namespace</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-3-DDL"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">2.2.3 DDL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-4-DML"><span class="toc-number">1.2.2.4.</span> <span class="toc-text">2.2.4 DML</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC6%E7%AB%A0-%E6%95%B4%E5%90%88Phoenix"><span class="toc-number">1.3.</span> <span class="toc-text">第6章 整合Phoenix</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-Phoenix%E7%AE%80%E4%BB%8B"><span class="toc-number">1.3.1.</span> <span class="toc-text">6.1 Phoenix简介</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-1-Phoenix%E5%AE%9A%E4%B9%89"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">6.1.1 Phoenix定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-2-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8Phoenix"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">6.1.2 为什么使用Phoenix</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-Phoenix%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">1.3.2.</span> <span class="toc-text">6.2 Phoenix快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-1-%E5%AE%89%E8%A3%85"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">6.2.1 安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-2-Phoenix-Shell%E6%93%8D%E4%BD%9C"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">6.2.2 Phoenix Shell操作</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-Phoenix%E4%BA%8C%E7%BA%A7%E7%B4%A2%E5%BC%95"><span class="toc-number">1.3.3.</span> <span class="toc-text">6.3 Phoenix二级索引</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-1-%E4%BA%8C%E7%BA%A7%E7%B4%A2%E5%BC%95%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">6.3.1 二级索引配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-2-%E5%85%A8%E5%B1%80%E7%B4%A2%E5%BC%95%EF%BC%88global-index%EF%BC%89"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">6.3.2 全局索引（global index）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%85%A8%E5%B1%80%E7%B4%A2%E5%BC%95"><span class="toc-number">1.4.</span> <span class="toc-text">创建全局索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%B4%A2%E5%BC%95%E6%98%AF%E5%90%A6%E6%9C%89%E6%95%88"><span class="toc-number">1.5.</span> <span class="toc-text">查看索引是否有效</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E9%9D%9E%E7%B4%A2%E5%BC%95%E5%AD%97%E6%AE%B5"><span class="toc-number">1.6.</span> <span class="toc-text">查询非索引字段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">1.7.</span> <span class="toc-text">解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-3-%E5%8C%85%E5%90%AB%E7%B4%A2%E5%BC%95%EF%BC%88covered-index%EF%BC%89"><span class="toc-number">1.7.0.1.</span> <span class="toc-text">6.3.3 包含索引（covered index）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-4-%E6%9C%AC%E5%9C%B0%E7%B4%A2%E5%BC%95%EF%BC%88local-index%EF%BC%89"><span class="toc-number">1.7.0.2.</span> <span class="toc-text">6.3.4 本地索引（local index）</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/09/Git-SSH%E5%AF%86%E9%92%A5%E9%85%8D%E7%BD%AE/" title="Git SSH密钥配置">Git SSH密钥配置</a><time datetime="2025-05-09T02:44:43.000Z" title="Created 2025-05-09 10:44:43">2025-05-09</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/30/%E6%89%8B%E5%8A%A8%E5%BC%80%E5%8F%91MCP%E9%A1%B9%E7%9B%AE/" title="手动开发MCP项目">手动开发MCP项目</a><time datetime="2025-04-30T05:56:05.000Z" title="Created 2025-04-30 13:56:05">2025-04-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/27/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E9%9D%A2%E8%AF%95%E9%A2%98-my/" title="计算机网络面试题(my)">计算机网络面试题(my)</a><time datetime="2025-04-27T12:56:41.000Z" title="Created 2025-04-27 20:56:41">2025-04-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/27/Java%E9%9D%A2%E8%AF%95%E7%AC%94%E8%AE%B0-my/" title="Java面试笔记(my)">Java面试笔记(my)</a><time datetime="2025-04-27T10:06:59.000Z" title="Created 2025-04-27 18:06:59">2025-04-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/26/%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0Go-Web%E5%BC%80%E5%8F%91%EF%BC%9AGin%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8/" title="深入学习Go Web开发：Gin框架使用">深入学习Go Web开发：Gin框架使用</a><time datetime="2025-04-26T09:45:40.000Z" title="Created 2025-04-26 17:45:40">2025-04-26</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By XiWei</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>